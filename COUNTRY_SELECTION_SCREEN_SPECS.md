# Спецификация экрана выбора стран (CountrySelectionScreen)

Этот документ описывает дизайн и функциональность нового экрана для выбора стран в качестве фильтра в каталоге.

## 1. Обзор

Текущая реализация фильтра стран в `BottomSheet` имеет проблемы с производительностью и UX. Новый экран `CountrySelectionScreen` заменит его, предоставив более стабильное и удобное решение для множественного выбора стран.

## 2. Навигация

- **Точка входа**: Экран каталога, виджет фильтра "Страна".
- **Действие**: При нажатии на виджет фильтра стран, приложение должно открывать `CountrySelectionScreen` как модальный экран (например, с помощью `showModalBottomSheet` с `isScrollControlled: true` или `Navigator.push`).

```mermaid
graph TD
    A[Экран каталога] -- Нажатие на фильтр "Страна" --> B{Открытие CountrySelectionScreen};
    B -- Пользователь нажимает "Применить" --> A;
    B -- Пользователь нажимает системную кнопку "Назад" --> A;
```

## 3. UI/UX экрана `CountrySelectionScreen`

### 3.1. AppBar

- **Заголовок**: "Выберите страны".
- **Действия (Actions)**:
    - **Кнопка "Сбросить"**: Текстовая кнопка или иконка. Сбрасывает все выбранные страны.
    - **Кнопка "Применить"**: Текстовая кнопка. Применяет выбранные фильтры и закрывает экран.

### 3.2. Тело экрана

- **Список стран**:
    - Данные для списка загружаются с помощью `countriesListProvider`.
    - Список должен быть реализован с использованием `ListView.builder` для оптимальной производительности.
    - Должен быть `TextField` для поиска по названию страны.

- **Элемент списка**:
    - Каждый элемент — это `CheckboxListTile`.
    - Отображает флаг страны (если возможно) и название страны.
    - `value` чекбокса отражает, выбрана ли страна.

## 4. Логика работы и управление состоянием

### 4.1. Управление состоянием

- **Локальное состояние**: Для отслеживания выбранных стран на экране `CountrySelectionScreen` будет использоваться локальный провайдер, например, `StateProvider<List<String>>`, который будет хранить `country.code` выбранных стран.
- **Инициализация**: При открытии экрана, локальный `StateProvider` инициализируется текущими выбранными значениями из фильтра каталога.
- **Взаимодействие**:
    - При нажатии на `CheckboxListTile`, `country.code` добавляется или удаляется из `StateProvider`.

### 4.2. Логика кнопок

- **"Применить"**:
    1. Читает состояние локального `StateProvider`.
    2. Обновляет основной провайдер фильтров каталога новыми значениями.
    3. Закрывает `CountrySelectionScreen` (`Navigator.pop(context)`).

- **"Сбросить"**:
    1. Очищает локальный `StateProvider` (устанавливает пустой список `[]`).
    2. Это немедленно отражается на UI (все чекбоксы снимаются).

## 5. План реализации (в коде)

1.  **Создать `country_selection_screen.dart`**:
    - Реализовать `StatelessWidget` или `ConsumerWidget`.
    - В методе `build` создать `Scaffold` с описанным `AppBar` и телом.
2.  **Интегрировать `countriesListProvider`**:
    - Обернуть `ListView.builder` в `countriesAsync.when` для обработки состояний загрузки, данных и ошибки.
3.  **Создать локальный `StateProvider`**:
    - `@riverpod StateProvider<List<String>>` для хранения кодов выбранных стран.
4.  **Реализовать логику `CheckboxListTile`**:
    - `onChanged` будет обновлять локальный `StateProvider`.
5.  **Реализовать логику кнопок "Применить" и "Сбросить"**.
6.  **Обновить `country_filter_widget.dart`**:
    - Заменить текущую логику `BottomSheet` на вызов `CountrySelectionScreen`.

# План тестирования функционала распознавания винных этикеток

## 1. Подготовка тестовых данных

### 1.1. База данных

Для обеспечения качественного тестирования необходимо, чтобы тестовая база данных содержала разнообразные записи.

- **Названия:**
    - Вина с названиями на **русском языке** (например, "Черный Доктор").
    - Вина с названиями на **английском языке** (например, "Chateau Margaux").
    - Вина со **смешанными** или **сложными** названиями (например, "Inkerman & Co").
- **Производители:**
    - Известные российские производители ("Массандра", "Фанагория").
    - Известные зарубежные производители ("Penfolds", "Domaine de la Romanée-Conti").
- **Характеристики:**
    - Разные **сорта винограда** (Каберне Совиньон, Шардоне, Мерло).
    - Разные **года урожая** (vintage), включая популярные и редкие.
    - Все типы **цвета** (`red`, `white`, `rose`) и **сахара** (`dry`, `semi-dry`, `sweet`).
- **Отсутствие данных:**
    - Записи, у которых 일부 поля (например, `grape_variety` или `vintage`) не заполнены, для проверки устойчивости алгоритма.

### 1.2. Изображения

Необходимо подготовить структурированный набор изображений для симуляции различных реальных условий.

- **Идеальные условия (`/ideal`):**
    - Четкие, фронтальные фотографии этикеток.
    - Хорошее, равномерное освещение без бликов.
    - **Пример:** `ideal_chateau_margaux_2015.jpg`
- **Сложные условия (`/complex`):**
    - **Угол:** Фотографии, сделанные под углом 30-45 градусов.
    - **Освещение:** Фотографии с бликами, тенями или в условиях низкой освещенности.
    - **Частичное перекрытие:** Этикетка частично закрыта пальцем или другим объектом.
    - **Пример:** `complex_angle_massandra_red.jpg`, `complex_glare_fanagoria_white.jpg`
- **"Шумные" этикетки (`/noisy`):**
    - Этикетки со сложным, витиеватым шрифтом.
    - Этикетки с фоновыми изображениями или узорами, мешающими OCR.
    - Этикетки с дополнительными маркетинговыми наклейками.
    - **Пример:** `noisy_font_inkerman_brut.jpg`
- **Без совпадений (`/no_match`):**
    - Фотографии этикеток вин, которых заведомо нет в нашей базе данных.
    - Фотографии других напитков (пиво, сок) для проверки ложных срабатываний.
    - **Пример:** `no_match_craft_beer.jpg`

## 2. План ручного тестирования (Test Cases)

Для каждого тестового случая необходимо зафиксировать используемый OCR-движок (Yandex, Google), сфотографированное изображение и результат.

| ID теста | Описание | Шаги для воспроизведения | Ожидаемый результат |
| :--- | :--- | :--- | :--- |
| **TC-IDEAL-01** | Распознавание идеального изображения (рус.) | 1. Выбрать Yandex OCR. <br> 2. Сфотографировать `ideal_massandra_red.jpg`. | Найдено вино "Массандра, Красный камень" с корректными характеристиками. Результат на первом месте. |
| **TC-IDEAL-02** | Распознавание идеального изображения (англ.) | 1. Выбрать Google OCR. <br> 2. Сфотографировать `ideal_chateau_margaux_2015.jpg`. | Найдено вино "Chateau Margaux 2015". Результат на первом месте. |
| **TC-CMPLX-01** | Распознавание фото под углом | 1. Выбрать Yandex OCR. <br> 2. Сфотографировать `complex_angle_fanagoria.jpg`. | Вино "Фанагория" найдено, возможно, не на первом месте, но в топ-3. |
| **TC-CMPLX-02** | Распознавание фото с бликом | 1. Выбрать Google OCR. <br> 2. Сфотографировать `complex_glare_some_wine.jpg`. | Вино найдено. Алгоритм должен справиться с частичной потерей информации. |
| **TC-CMPLX-03** | Распознавание частично перекрытой этикетки | 1. Выбрать Yandex OCR. <br> 2. Сфотографировать `complex_partial_covered.jpg`. | Вино найдено. Оценка релевантности может быть ниже, но вино присутствует в результатах. |
| **TC-NOISY-01** | Распознавание этикетки со сложным шрифтом | 1. Выбрать Google OCR. <br> 2. Сфотографировать `noisy_font_inkerman.jpg`. | Вино "Inkerman" найдено. Проверяем, как OCR справляется со сложными шрифтами. |
| **TC-NOMATCH-01**| Распознавание этикетки без совпадения в БД | 1. Выбрать Yandex OCR. <br> 2. Сфотографировать `no_match_unknown_wine.jpg`. | Результаты поиска пусты. Система сообщает, что вино не найдено. |
| **TC-NOMATCH-02**| Распознавание изображения другого напитка | 1. Выбрать Google OCR. <br> 2. Сфотографировать `no_match_craft_beer.jpg`. | Результаты поиска пусты. Нет ложных срабатываний на пивную этикетку. |
| **TC-CHARS-01** | Проверка извлечения всех характеристик | 1. Выбрать Yandex OCR. <br> 2. Сфотографировать этикетку, где четко видны: название, производитель, сорт, год, цвет, сахар. | Все характеристики извлечены и использованы для поиска. Найдено правильное вино. |
| **TC-CHARS-02** | Проверка устойчивости к отсутствию характеристик | 1. Выбрать Google OCR. <br> 2. Сфотографировать этикетку, где указано только название и производитель. | Поиск выполнен успешно по доступным данным. Найдено правильное вино. |

## 3. План автоматизированного тестирования

Автоматические тесты критически важны для проверки отдельных компонентов и их взаимодействия.

### 3.1. Unit-тесты

Основной фокус — `WineLabelTextProcessor`.

- **`processText`:**
    - **Тест на нормализацию:** Подать на вход строку `"вино красн. сух."`, ожидать на выходе `"красное сухое"`.
    - **Тест на удаление стоп-слов:** Подать строку `"вино Chateau Margaux premier grand cru classe"`, ожидать, что слова типа "вино", "premier", "grand" будут удалены (если они в стоп-листе).
    - **Тест на извлечение алкоголя:** Подать `"Алк. 12.5% об."`, ожидать `12.5`.
    - **Тест на извлечение года:** Подать `"Урожай 2020 года"`, ожидать `2020`.
    - **Тест на извлечение названия в кавычках:** Подать `"Вино «Черный полковник»"`, ожидать, что `_extractName` вернет `"Черный полковник"`.
    - **Тест на граничные случаи:** Подать пустую строку, строку из спецсимволов, очень длинный текст. Ожидаемое поведение — отсутствие падений, возврат пустого или частично заполненного `WineLabelData`.

### 3.2. Интеграционные тесты

Цель — протестировать `wineLabelSearchProvider` в сборе.

- **Мокирование репозитория:**
    - Создать мок `WinesRepository` с помощью `Mockito`.
    - Настроить `when(mockWinesRepository.searchWines(any)).thenAnswer(...)` для возврата предопределенного списка вин.
- **Сценарии для `wineLabelSearchProvider`:**
    - **Тест на точный поиск:**
        - `recognizedText`: "Chateau Lafite 2018"
        - `mockWinesRepository` возвращает `[Wine(name: 'Chateau Lafite', vintage: 2018)]`.
        - **Ожидание:** `wineLabelSearchProvider` возвращает этот единственный результат.
    - **Тест на ранжирование:**
        - `recognizedText`: "Красное сухое Мерло"
        - `mockWinesRepository` возвращает 3 вина:
            1. `Wine(name: 'Какое-то Мерло', color: red, sugar: dry)`
            2. `Wine(name: 'Просто Мерло', color: red, sugar: semi-sweet)`
            3. `Wine(name: 'Другое вино', color: white, sugar: dry)`
        - **Ожидание:** Первое вино должно получить наивысший балл релевантности и оказаться на первом месте в отсортированном списке.
    - **Тест на пустой результат:**
        - `recognizedText`: "Несуществующее вино"
        - `mockWinesRepository` возвращает пустой список `[]`.
        - **Ожидание:** `wineLabelSearchProvider` возвращает пустой список.
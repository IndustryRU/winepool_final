# Спецификация экрана выбора регионов (RegionSelectionScreen)

Этот документ описывает дизайн и функциональность нового экрана для выбора регионов в качестве фильтра в каталоге.

## 1. Обзор

Текущая реализация фильтра регионов в `BottomSheet` вызывает проблемы с компоновкой, производительностью и UX. Новый экран `RegionSelectionScreen` заменит его, предоставив более стабильное и удобное решение для множественного выбора регионов, аналогично уже реализованному экрану выбора стран.

## 2. Навигация

- **Точка входа**: Экран каталога, виджет фильтра "Регион".
- **Действие**: При нажатии на виджет фильтра регионов, приложение должно открывать `RegionSelectionScreen` как модальный экран (например, с помощью `Navigator.push`).

```mermaid
graph TD
    A[Экран каталога] -- Нажатие на фильтр "Регион" --> B{Открытие RegionSelectionScreen};
    B -- Пользователь нажимает "Применить" --> A;
    B -- Пользователь нажимает системную кнопку "Назад" --> A;
```

## 3. UI/UX экрана `RegionSelectionScreen`

### 3.1. AppBar

- **Заголовок**: "Выберите регионы".
- **Действия (Actions)**:
    - **Кнопка "Сбросить"**: Текстовая кнопка. Сбрасывает все выбранные регионы в локальном состоянии экрана.
    - **Кнопка "Применить"**: Текстовая кнопка. Применяет выбранные фильтры и закрывает экран.

### 3.2. Тело экрана

- **Список регионов**:
    - Данные для списка загружаются с помощью `regionsListProvider`, который зависит от `catalogFiltersProvider` (выбранных стран).
    - Список должен быть реализован с использованием `ListView.builder` для оптимальной производительности.
    - Должен быть `TextField` для поиска по названию региона.

- **Элемент списка**:
    - Каждый элемент — это `CheckboxListTile`.
    - Отображает название региона (`region.name`).
    - `value` чекбокса отражает, выбран ли регион.

## 4. Логика работы и управление состоянием

### 4.1. Управление состоянием

- **Локальное состояние**: Для отслеживания выбранных регионов на экране `RegionSelectionScreen` будет использоваться локальный провайдер, например, `@riverpod class SelectedRegions extends _$SelectedRegions`, который будет хранить `region.id` выбранных регионов.
- **Инициализация**: При открытии экрана, локальный провайдер инициализируется текущими выбранными значениями из `catalogFiltersProvider`.
- **Взаимодействие**:
    - При нажатии на `CheckboxListTile`, `region.id` добавляется или удаляется из локального провайдера.

### 4.2. Логика кнопок

- **"Применить"**:
    1. Читает состояние локального провайдера `selectedRegionsProvider`.
    2. Вызывает метод `ref.read(catalogFiltersProvider.notifier).updateRegion(selectedRegions)`.
    3. Закрывает `RegionSelectionScreen` (`Navigator.pop(context)`).

- **"Сбросить"**:
    1. Очищает локальный провайдер `selectedRegionsProvider` (устанавливает пустой список `[]`).
    2. Это немедленно отражается на UI (все чекбоксы снимаются).

## 5. План реализации (в коде)

1.  **Создать `region_selection_screen.dart`**:
    - Реализовать `ConsumerStatefulWidget` для управления локальным состоянием и поиском.
    - В `build` создать `Scaffold` с описанным `AppBar` и телом.
2.  **Интегрировать `regionsListProvider`**:
    - Обернуть `ListView.builder` в `regionsAsync.when` для обработки состояний загрузки, данных и ошибки.
3.  **Создать локальный провайдер `selectedRegionsProvider`**:
    - `@riverpod class SelectedRegions extends _$SelectedRegions` для хранения ID выбранных регионов.
4.  **Реализовать логику `CheckboxListTile`**:
    - `onChanged` будет обновлять локальный `selectedRegionsProvider`.
5.  **Реализовать логику кнопок "Применить" и "Сбросить"**.
6.  **Обновить `region_filter_widget.dart`**:
    - Заменить текущую логику на виджет, который будет открывать `RegionSelectionScreen` по нажатию.
    - Этот виджет будет получать выбранные регионы из `catalogFiltersProvider` и отображать их в свернутом виде (например, "2 региона" или название одного региона).
